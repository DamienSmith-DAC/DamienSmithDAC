#Remove 'default' security group from all VMs
openstack --insecure server list | awk '{print $4}' | tail -n +4 | head -n -1 | while read line ; do openstack --insecure server show $line; done

#Apply 'default' security group to all VMs
openstack --insecure server list | awk '{print $4}' | tail -n +4 | head -n -1 | while read line ; do `openstack --insecure server show $line | grep 'name='` ; done

#Show flavors for all VMs
openstack --insecure server list | awk '{print $4}' | tail -n +4 | head -n -1 | while read line ; do echo $line && os server show $line | grep flavor | awk '{print "\t flavor:" $4}'; done

#Show HOSTS for all VMs
openstack --insecure server list | awk '{print $4}' | tail -n +4 | head -n -1 | while read line ; do echo $line && os server show $line | grep hypervisor_hostname | awk '{print "\t availability:" $4}'; done

#Delete security group rules by Port range -Current form only echos the delete commands for review
os security group rule list mgmt_security_group | grep 636:636 | awk '{print $2}' | while read line; do echo openstack --insecure security group rule delete $line ; done


#Auto floating IP
NEW_VM_NAME="temp-centos-bootablevolume"
NEW_VM_STATIC_IP=`openstack --insecure server show ${NEW_VM_NAME} | grep addresses | awk '{print $4}' | perl -pane 's%^(.*)=((\d?\d?\d\.){3}(\d?\d?\d))$%$2%'`
NEW_VM_PORT_ID=`openstack --insecure port list | grep ${NEW_VM_STATIC_IP} | awk '{print $2}'`
NEW_FLOATING_IP_NAME=`openstack --insecure floating ip create DAC_GATEWAY_NET | grep name | awk '{print $4}'`
openstack --insecure floating ip set --port ${NEW_VM_PORT_ID} ${NEW_FLOATING_IP_NAME}
echo ${NEW_FLOATING_IP_NAME} associated to ${NEW_VM_NAME}

#List all security groups applied to all VMs
openstack --insecure server list | awk '{print $4}' | tail -n +4 | head -n -1 | while read line ; do echo $line && openstack --insecure server show $line | grep name= | awk '{print $3 $4}' | perl -pane "s%^\|?name\=\'([^']+)\'\|?%\tSecurity\ group\:\ \1%g" ; done

#List all subnets AND security groups applied to all VMs

#!/bin/bash
echo "Script is running - please be patient - it takes about 5 minutes to make all the API calls"
(
printf 'ServerName\tSubnet\tSecurityGroup\n'
openstack --insecure server list | awk '{print $4}' | tail -n +4 | head -n -1 | while read line
do 
  server_name=${line} 
  server_subnet=`openstack --insecure server show $server_name | grep '| addresses' | awk '{print $4}' | cut -d'=' -f1`
  server_sec_groups=`openstack --insecure server show $server_name | grep name= | awk '{print $3 $4}' | perl -pane "s%^\|?name\=\'([^']+)\'\|?%\1%g"`
  sec_group_counter=0
  for sec_group in ${server_sec_groups}
  do
    if (( sec_group_counter == 0 )); then
      printf '\n%s\t%s\t%s\n' ${server_name} ${server_subnet} ${sec_group}
    else
      printf '%s\t%s\t%s\n' "$emptyvar" "$emptyvar" "${sec_group}"
    fi
    sec_group_counter=$((sec_group_counter+1))
  done
done
) | column -t -s $'\t'

#output above as csv
cat output-of-secgrouplist | perl -pane 's%^([\w\_\-]*)?\s+?([\w\_\-]*)?\s+([\w\_\-]*)$%\1,\2,\3%'
